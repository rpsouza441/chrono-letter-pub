# ========================================
# Chrono Letter - PROD Profile
# ========================================
# Ativar com: --spring.profiles.active=prod
# IMPORTANTE: Todas as variáveis sensíveis devem vir de ENV ou Docker Secrets

spring:
  # ----------------------------------------
  # Database (via ENV)
  # ----------------------------------------
  datasource:
    url: ${DATABASE_URL}
    username: ${DATABASE_USERNAME}
    password: ${DATABASE_PASSWORD}
    hikari:
      maximum-pool-size: ${DATABASE_POOL_SIZE:20}
      minimum-idle: 5
      connection-timeout: 30000
      leak-detection-threshold: 60000

  jpa:
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        generate_statistics: false

  # ----------------------------------------
  # Email (SMTP real ou SES)
  # ----------------------------------------
  mail:
    host: ${SMTP_HOST}
    port: ${SMTP_PORT:587}
    username: ${SMTP_USERNAME}
    password: ${SMTP_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000

  # ----------------------------------------
  # Security
  # ----------------------------------------
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}

# ========================================
# Prod-specific properties
# ========================================
chronoletter:
  frontend-url: ${FRONTEND_URL}
  master-key-path: /run/secrets/master_key
  
  mail:
    from: ${MAIL_FROM}
    from-name: ${MAIL_FROM_NAME:Chrono Letter}

# ========================================
# Server (prod hardening)
# ========================================
server:
  error:
    include-message: never
    include-stacktrace: never
    include-binding-errors: never
  
  # Headers de segurança são configurados via SecurityConfig
  # mas podemos definir alguns aqui
  tomcat:
    remoteip:
      remote-ip-header: X-Forwarded-For
      protocol-header: X-Forwarded-Proto

# ========================================
# Actuator (restrito em prod)
# ========================================
management:
  endpoints:
    web:
      exposure:
        include: health, info, prometheus
  endpoint:
    health:
      show-details: never

# ========================================
# Logging (JSON estruturado para prod)
# ========================================
logging:
  level:
    root: WARN
    br.dev.rodrigopinheiro.chronoletter: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN
    org.hibernate: WARN

  # JSON logging via logstash-logback-encoder
  # Configuração em logback-spring.xml para prod
